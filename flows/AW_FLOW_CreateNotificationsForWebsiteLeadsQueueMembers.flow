<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>53.0</apiVersion>
    <assignments>
        <name>AW_AddRecordsToCollection</name>
        <label>Add Records To Collection</label>
        <locationX>774</locationX>
        <locationY>522</locationY>
        <assignmentItems>
            <assignToReference>AW_CustomTimeBasedNotificationRecordsCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>AW_CustomNotificationRecord0Minute</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomTimeBasedNotificationRecordsCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>AW_CustomNotificationRecord30Minutes</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AW_CustomTimeBasedNotificationRecords</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AW_Create0MinuteNotificationRecord</name>
        <label>Create 0 Minute Notification Record</label>
        <locationX>434</locationX>
        <locationY>522</locationY>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_CustomNotificationAPIName__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>AW_CustomTimeBasedNotificationToWebsiteLeadsQueueMembers</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_NotificationTitle__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_AssignmentNotificationTitle</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_NotificationBody__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_0MinutesNotificationBody</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_NotificationDateTime__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_DateTimeOutput0Minutes</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_ParentId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_Recipients__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_GetQueue.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_TargetId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord0Minute.AW_NotificationType__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>AW_InAppPush</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AW_Create30MinutesNotificationRecord</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AW_Create30MinutesNotificationRecord</name>
        <label>Create 30 Minutes Notification Record</label>
        <locationX>577</locationX>
        <locationY>522</locationY>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_CustomNotificationAPIName__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>AW_CustomTimeBasedNotificationToWebsiteLeadsQueueMembers</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_NotificationTitle__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_AssignmentNotificationTitle</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_NotificationBody__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_30MinutesNotificationBody</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_NotificationDateTime__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_DateTimeOutput30Minutes</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_ParentId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_Recipients__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AW_GetQueue.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_TargetId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AW_CustomNotificationRecord30Minutes.AW_NotificationType__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>AW_InAppPush</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AW_AddRecordsToCollection</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>AW_CreateRecordsOrDeleteRecords</name>
        <label>Create Records Or Delete Records?</label>
        <locationX>768</locationX>
        <locationY>399</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>AW_NewLead</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>AW_LeadIsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.AW_LeadAllocationStatus__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AW_GetQueue</targetReference>
            </connector>
            <label>New Lead</label>
        </rules>
        <rules>
            <name>AW_OwnerOrAllocationStatusChanged</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.OwnerId</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.AW_LeadAllocationStatus__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AW_FLOW_DeleteCustomTimeBasedNotifications</targetReference>
            </connector>
            <label>Owner Or Allocation Status Changed</label>
        </rules>
    </decisions>
    <decisions>
        <name>AW_OwnerIsWebsiteLeadsQueue</name>
        <label>Owner Is Website Leads Queue?</label>
        <locationX>430</locationX>
        <locationY>396</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>AW_WebsiteLeadsQueue</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.OwnerId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>AW_GetQueue.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AW_NotificationTime0BusinessMinutes</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Creates custom time-based notification records for &apos;Website Leads Queue&apos; members.
The flow will also invoke &apos;AW_FLOW_SendCustomTimeBasedNotification&apos; flow which will be used to send notification according to the time defined in the notification records.
@author latika.kharbanda@accenture.com
@date October 2021</description>
    <formulas>
        <name>AW_AssignmentNotificationTime0BusinessMinutes</name>
        <dataType>DateTime</dataType>
        <expression>(DATETIMEVALUE ({!AW_ResultNotificationTime0BusinessMinutes}))</expression>
    </formulas>
    <formulas>
        <name>AW_AssignmentNotificationTime30BusinessMinutes</name>
        <dataType>DateTime</dataType>
        <expression>(DATETIMEVALUE ({!AW_ResultNotificationTime30BusinessMinutes}))</expression>
    </formulas>
    <formulas>
        <name>AW_DateTimeInput30Minutes</name>
        <dataType>DateTime</dataType>
        <expression>DATETIMEVALUE({!AW_ResultNotificationTime0BusinessMinutes}) + 30/1440</expression>
    </formulas>
    <formulas>
        <name>AW_DateTimeOutput0Minutes</name>
        <dataType>DateTime</dataType>
        <expression>(DATETIMEVALUE ({!AW_ResultNotificationTime0BusinessMinutes}))</expression>
    </formulas>
    <formulas>
        <name>AW_DateTimeOutput30Minutes</name>
        <dataType>DateTime</dataType>
        <expression>(DATETIMEVALUE ({!AW_ResultNotificationTime30BusinessMinutes}))</expression>
    </formulas>
    <formulas>
        <name>AW_LeadIsNew</name>
        <dataType>Boolean</dataType>
        <expression>(ISNEW())</expression>
    </formulas>
    <interviewLabel>Create Notifications For Website Leads Queue Members {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Create Notifications For Website Leads Queue Members</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>AW_CustomTimeBasedNotificationRecords</name>
        <label>Custom Time-Based Notification Records</label>
        <locationX>1013</locationX>
        <locationY>522</locationY>
        <inputReference>AW_CustomTimeBasedNotificationRecordsCollection</inputReference>
    </recordCreates>
    <recordLookups>
        <name>AW_GetQueue</name>
        <label>Get Queue</label>
        <locationX>574</locationX>
        <locationY>394</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AW_OwnerIsWebsiteLeadsQueue</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Queue</stringValue>
            </value>
        </filters>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>AW_WebsiteLeadsQueue</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>650</locationX>
        <locationY>87</locationY>
        <connector>
            <targetReference>AW_CreateRecordsOrDeleteRecords</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LeadSource</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Website</stringValue>
            </value>
        </filters>
        <object>Lead</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>AW_FLOW_DeleteCustomTimeBasedNotifications</name>
        <label>Delete Custom Time-Based Notifications</label>
        <locationX>1013</locationX>
        <locationY>400</locationY>
        <flowName>AW_FLOW_DeleteCustomTimeBasedNotificationRecords</flowName>
        <inputAssignments>
            <name>AW_ParentId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>AW_NotificationTime0BusinessMinutes</name>
        <label>Notification Time 0 Business Minutes</label>
        <locationX>279</locationX>
        <locationY>394</locationY>
        <connector>
            <targetReference>AW_NotificationTime30BusinessMinutes</targetReference>
        </connector>
        <flowName>AW_FLOW_CalculateBusinessHours</flowName>
        <inputAssignments>
            <name>AW_DateTimeInput</name>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>AW_ResultNotificationTime0BusinessMinutes</assignToReference>
            <name>AW_NotificationTime</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>AW_NotificationTime30BusinessMinutes</name>
        <label>Notification Time 30 Business Minutes</label>
        <locationX>280</locationX>
        <locationY>522</locationY>
        <connector>
            <targetReference>AW_Create0MinuteNotificationRecord</targetReference>
        </connector>
        <flowName>AW_FLOW_CalculateBusinessHours</flowName>
        <inputAssignments>
            <name>AW_DateTimeInput</name>
            <value>
                <elementReference>AW_DateTimeInput30Minutes</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>AW_ResultNotificationTime30BusinessMinutes</assignToReference>
            <name>AW_NotificationTime</name>
        </outputAssignments>
    </subflows>
    <textTemplates>
        <name>AW_0MinutesNotificationBody</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>A new Lead {!$Record.FirstName} {!$Record.LastName} has entered the queue, please action this and allocate to an adviser as soon as possible.</text>
    </textTemplates>
    <textTemplates>
        <name>AW_30MinutesNotificationBody</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>The Lead {!$Record.FirstName} {!$Record.LastName} has now been in the queue waiting for 30 minutes, please action this lead as soon as possible.</text>
    </textTemplates>
    <textTemplates>
        <name>AW_AssignmentNotificationTitle</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>You have a new lead!</text>
    </textTemplates>
    <variables>
        <name>AW_CustomNotificationRecord0Minute</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AW_CustomTimeBasedNotification__c</objectType>
    </variables>
    <variables>
        <name>AW_CustomNotificationRecord30Minutes</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AW_CustomTimeBasedNotification__c</objectType>
    </variables>
    <variables>
        <name>AW_CustomNotificationRecordsToDelete</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AW_CustomTimeBasedNotification__c</objectType>
    </variables>
    <variables>
        <name>AW_CustomTimeBasedNotificationRecordsCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AW_CustomTimeBasedNotification__c</objectType>
    </variables>
    <variables>
        <name>AW_ResultNotificationTime0BusinessMinutes</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>AW_ResultNotificationTime30BusinessMinutes</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
